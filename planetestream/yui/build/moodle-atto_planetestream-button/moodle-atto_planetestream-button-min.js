YUI.add("moodle-atto_planetestream-button",function(e,t){ var a,i,r,o,l;e.namespace("M.atto_planetestream").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{initializer:function(){!this.get("disabled")&&this.addButton({icon:"button",iconComponent:"atto_planetestream",title:"pluginname",buttonName:"button",callback:this._displayDialogue})},_listen:function(){window.addEventListener?(a="addEventListener",i="message"):window.postMessage?(a="attachEvent",i="onmessage"):r._insertContent("Sorry, your web-browser is not compatible with this feature."),(0,window[a])(i,function(e){if(e.target.removeEventListener(e.type,arguments.callee),e.data.indexOf("ID=")>-1&&(e.data.indexOf("&source=moodle")>-1||e.data.indexOf("&source=Moodle")>-1)){var t=r.get("pagetype");if("mod-assign-editsubmission"==t||"mod-assign-gradingpanel"==t){var a=e.data,i=r._getQS(a,"title");i=i.split("+").join(" "),e.data.indexOf("delta=")>-1?r._insertContent('<a href="'+r.get("estream_url")+"/View.aspx?"+e.data+'" target="_blank">'+i+"</a><br><br>"):r._insertContent('<a href="'+r.get("estream_url")+"/View.aspx?"+e.data+'&delta=ESDLTA" target="_blank">'+i+"</a><br><br>")}else 0==r.get("estream_width")&&0==r.get("estream_height")?e.data.indexOf("delta=")>-1?r._insertContent('<div style="position:relative;overflow:hidden;padding-top:56.25%;"><iframe allow="autoplay; fullscreen" allowfullscreen style="position:absolute;top:0;left:0;width:100%;height:100%;border:0;" src="'+r.get("estream_url")+"/Embed.aspx?"+e.data+'"></iframe><a href="/_planetestreamiframe_/Embed.aspx?'+e.data+'">&nbsp;</a></div>'):r._insertContent('<div style="position:relative;overflow:hidden;padding-top:56.25%;"><iframe allow="autoplay; fullscreen" allowfullscreen style="position:absolute;top:0;left:0;width:100%;height:100%;border:0;" src="'+r.get("estream_url")+"/Embed.aspx?"+e.data+'&delta=ESDLTA"></iframe><a href="/_planetestreamiframe_/Embed.aspx?'+e.data+'&delta=ESDLTA">&nbsp;</a></div>'):e.data.indexOf("delta=")>-1?r._insertContent('<iframe allow="autoplay; fullscreen" allowfullscreen style="width: '+r.get("estream_width")+"px; height: "+r.get("estream_height")+'px; border: 0" src="'+r.get("estream_url")+"/Embed.aspx?"+e.data+'"></iframe><a href="_planetestreamiframe_/Embed.aspx?'+e.data+'"></a>'):r._insertContent('<iframe allow="autoplay; fullscreen" allowfullscreen style="width: '+r.get("estream_width")+"px; height: "+r.get("estream_height")+'px; border: 0" src="'+r.get("estream_url")+"/Embed.aspx?"+e.data+'&delta=ESDLTA"></iframe><a href="_planetestreamiframe_/Embed.aspx?'+e.data+'&delta=ESDLTA"></a>')}},!1)},_insertContent:function(e){l||(r.getDialogue().hide(),r.editor.focus(),r.get("host").insertContentAtFocusPoint(e),r.markUpdated())},_getQS:function(e,t){for(var a=e.split("&"),i=0;i<a.length;i++){var r=a[i].split("=");if(decodeURIComponent(r[0])==t)return decodeURIComponent(r[1])}return"Response"},_displayDialogue:function(t){t.preventDefault();var a=this.getDialogue({headerContent:"Insert Planet eStream Item",width:"1000px",height:"700px"});"1000px"!==a.width&&a.set("width","1000px"),"700px"!==a.width&&a.set("height","700px"),(o=e.Node.create("<div></div>")).append('<form class="atto_form"><div class="mdl-align" style="overflow:auto;-webkit-overflow-scrolling:touch;"><iframe allow="microphone; camera;" id="ifestream" style="border: 0px; width: '+(parseInt(1e3,10)-78)+"px;height: "+(parseInt(700,10)-65)+'px;" src="'+this.get("estream_url")+this.get("estream_path")+"&td="+window.location.protocol+"//"+window.location.host+":"+(("80"===window.location.port&&"http"===window.location.protocol)|("443"===window.location.port&&"https"===window.location.protocol)?"":window.location.port)+'"></iframe></div></form>'),a.set("bodyContent",o),a.show(),this.markUpdated(),r=this,r._listen()}},{ATTRS:{disabled:{value:!1},usercontextid:{value:null},estream_url:{value:""},estream_path:{value:""},estream_height:{value:""},estream_width:{value:""},pagetype:{value:""}}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});